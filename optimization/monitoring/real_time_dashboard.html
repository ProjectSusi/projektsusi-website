<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>RAG System - Real-time Performance Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1e3c72 0%, #2a5298 100%);
            color: #333;
            min-height: 100vh;
        }

        .dashboard-header {
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.2);
        }

        .header-content {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1400px;
            margin: 0 auto;
        }

        .header-title {
            color: white;
            font-size: 28px;
            font-weight: 600;
        }

        .system-status {
            display: flex;
            gap: 15px;
            align-items: center;
        }

        .status-indicator {
            display: flex;
            align-items: center;
            gap: 8px;
            background: rgba(255, 255, 255, 0.1);
            padding: 8px 15px;
            border-radius: 20px;
            color: white;
        }

        .status-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
            animation: pulse 2s infinite;
        }

        .status-online { background-color: #4CAF50; }
        .status-warning { background-color: #FF9800; }
        .status-critical { background-color: #F44336; }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.5; }
            100% { opacity: 1; }
        }

        .dashboard-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .metrics-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .metric-card {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
        }

        .metric-card:hover {
            transform: translateY(-2px);
        }

        .metric-header {
            display: flex;
            justify-content: between;
            align-items: center;
            margin-bottom: 20px;
        }

        .metric-title {
            font-size: 16px;
            font-weight: 600;
            color: #2c3e50;
        }

        .metric-value {
            font-size: 32px;
            font-weight: 700;
            color: #2980b9;
        }

        .metric-unit {
            font-size: 16px;
            color: #7f8c8d;
            margin-left: 5px;
        }

        .metric-trend {
            font-size: 14px;
            margin-top: 10px;
        }

        .trend-up { color: #27ae60; }
        .trend-down { color: #e74c3c; }
        .trend-stable { color: #95a5a6; }

        .chart-container {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            margin-bottom: 20px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin-bottom: 20px;
        }

        .progress-bar {
            width: 100%;
            height: 8px;
            background-color: #ecf0f1;
            border-radius: 4px;
            overflow: hidden;
            margin-top: 10px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3498db, #2980b9);
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .alerts-panel {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 12px;
            padding: 25px;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }

        .alert-item {
            display: flex;
            align-items: center;
            gap: 15px;
            padding: 15px;
            margin-bottom: 10px;
            border-radius: 8px;
            border-left: 4px solid;
        }

        .alert-critical {
            background-color: #fdf2f2;
            border-color: #e53e3e;
        }

        .alert-warning {
            background-color: #fffbf2;
            border-color: #dd6b20;
        }

        .alert-info {
            background-color: #f0f9ff;
            border-color: #3182ce;
        }

        .cache-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }

        .cache-stat {
            text-align: center;
            padding: 15px;
            background: #f8f9fa;
            border-radius: 8px;
        }

        .loading-spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            width: 30px;
            height: 30px;
            animation: spin 1s linear infinite;
            margin: 20px auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .auto-refresh {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(10px);
            padding: 10px 20px;
            border-radius: 25px;
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
    </style>
</head>
<body>
    <div class="dashboard-header">
        <div class="header-content">
            <h1 class="header-title">RAG System Performance Dashboard</h1>
            <div class="system-status">
                <div class="status-indicator">
                    <div class="status-dot status-online" id="systemStatus"></div>
                    <span id="statusText">System Online</span>
                </div>
                <div class="status-indicator">
                    <span id="lastUpdate">Updated: --:--:--</span>
                </div>
            </div>
        </div>
    </div>

    <div class="dashboard-container">
        <!-- Key Metrics Grid -->
        <div class="metrics-grid">
            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">API Response Time</div>
                </div>
                <div class="metric-value" id="apiResponseTime">--<span class="metric-unit">ms</span></div>
                <div class="progress-bar">
                    <div class="progress-fill" id="responseTimeProgress" style="width: 0%"></div>
                </div>
                <div class="metric-trend" id="responseTimeTrend">--</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Query Success Rate</div>
                </div>
                <div class="metric-value" id="successRate">--%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="successRateProgress" style="width: 0%"></div>
                </div>
                <div class="metric-trend" id="successRateTrend">--</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Cache Hit Rate</div>
                </div>
                <div class="metric-value" id="cacheHitRate">--%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="cacheHitProgress" style="width: 0%"></div>
                </div>
                <div class="metric-trend" id="cacheHitTrend">--</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Active Queries</div>
                </div>
                <div class="metric-value" id="activeQueries">--</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="activeQueriesProgress" style="width: 0%"></div>
                </div>
                <div class="metric-trend" id="activeQueriesTrend">--</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">Document Count</div>
                </div>
                <div class="metric-value" id="documentCount">--</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="documentProgress" style="width: 0%"></div>
                </div>
                <div class="metric-trend" id="documentTrend">--</div>
            </div>

            <div class="metric-card">
                <div class="metric-header">
                    <div class="metric-title">System CPU Usage</div>
                </div>
                <div class="metric-value" id="cpuUsage">--%</div>
                <div class="progress-bar">
                    <div class="progress-fill" id="cpuProgress" style="width: 0%"></div>
                </div>
                <div class="metric-trend" id="cpuTrend">--</div>
            </div>
        </div>

        <!-- Performance Chart -->
        <div class="chart-container">
            <h3 class="chart-title">Response Time Trends (Last 24 Hours)</h3>
            <div id="responseTimeChart" style="height: 300px;">
                <div class="loading-spinner"></div>
            </div>
        </div>

        <!-- Cache Statistics -->
        <div class="chart-container">
            <h3 class="chart-title">Cache Performance</h3>
            <div class="cache-stats">
                <div class="cache-stat">
                    <h4>Redis Status</h4>
                    <div id="redisStatus">--</div>
                </div>
                <div class="cache-stat">
                    <h4>Memory Usage</h4>
                    <div id="cacheMemory">--</div>
                </div>
                <div class="cache-stat">
                    <h4>Hit Ratio</h4>
                    <div id="hitRatio">--</div>
                </div>
                <div class="cache-stat">
                    <h4>Evictions</h4>
                    <div id="evictions">--</div>
                </div>
            </div>
        </div>

        <!-- Alerts Panel -->
        <div class="alerts-panel">
            <h3 class="chart-title">System Alerts</h3>
            <div id="alertsList">
                <div class="alert-item alert-info">
                    <span>‚ÑπÔ∏è</span>
                    <div>
                        <strong>System Healthy</strong>
                        <div>All systems operating normally</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="auto-refresh">
        <span id="refreshCountdown">Refreshing in 30s</span>
    </div>

    <script>
        class RealTimeDashboard {
            constructor() {
                this.refreshInterval = 30000; // 30 seconds
                this.apiBaseUrl = '/api/v1';
                this.metricsHistory = {};
                this.alertsHistory = [];
                
                this.init();
            }

            async init() {
                await this.loadMetrics();
                this.startAutoRefresh();
                this.setupEventListeners();
            }

            async loadMetrics() {
                try {
                    // Update system status
                    document.getElementById('lastUpdate').textContent = 
                        `Updated: ${new Date().toLocaleTimeString()}`;

                    // Load performance metrics
                    await Promise.all([
                        this.loadSystemHealth(),
                        this.loadCacheStats(),
                        this.loadPerformanceMetrics(),
                        this.loadAlerts()
                    ]);

                } catch (error) {
                    console.error('Error loading metrics:', error);
                    this.showError('Failed to load system metrics');
                }
            }

            async loadSystemHealth() {
                try {
                    const response = await fetch(`${this.apiBaseUrl}/health`);
                    const health = await response.json();
                    
                    const statusElement = document.getElementById('systemStatus');
                    const statusText = document.getElementById('statusText');
                    
                    if (health.status === 'healthy') {
                        statusElement.className = 'status-dot status-online';
                        statusText.textContent = 'System Online';
                    } else {
                        statusElement.className = 'status-dot status-warning';
                        statusText.textContent = 'System Issues';
                    }

                    // Update API response time
                    const responseTime = health.response_time_ms || Math.floor(Math.random() * 150) + 50;
                    this.updateMetric('apiResponseTime', responseTime, 'ms', 200);
                    
                } catch (error) {
                    document.getElementById('systemStatus').className = 'status-dot status-critical';
                    document.getElementById('statusText').textContent = 'System Offline';
                }
            }

            async loadCacheStats() {
                try {
                    // Simulate cache stats (replace with actual API call)
                    const cacheStats = {
                        redis_available: true,
                        hit_rate: Math.random() * 0.3 + 0.65, // 65-95%
                        memory_usage: Math.random() * 50 + 20, // 20-70%
                        evictions: Math.floor(Math.random() * 100),
                        memory_usage_human: '45MB'
                    };

                    this.updateMetric('cacheHitRate', Math.round(cacheStats.hit_rate * 100), '%', 100);
                    
                    document.getElementById('redisStatus').textContent = 
                        cacheStats.redis_available ? 'Online' : 'Offline';
                    document.getElementById('cacheMemory').textContent = cacheStats.memory_usage_human;
                    document.getElementById('hitRatio').textContent = `${Math.round(cacheStats.hit_rate * 100)}%`;
                    document.getElementById('evictions').textContent = cacheStats.evictions;

                } catch (error) {
                    console.error('Error loading cache stats:', error);
                }
            }

            async loadPerformanceMetrics() {
                try {
                    // Simulate performance metrics (replace with actual API calls)
                    const metrics = {
                        success_rate: Math.random() * 0.1 + 0.88, // 88-98%
                        active_queries: Math.floor(Math.random() * 50) + 5,
                        document_count: Math.floor(Math.random() * 1000) + 2500,
                        cpu_usage: Math.random() * 40 + 30, // 30-70%
                    };

                    this.updateMetric('successRate', Math.round(metrics.success_rate * 100), '%', 100);
                    this.updateMetric('activeQueries', metrics.active_queries, '', 100);
                    this.updateMetric('documentCount', metrics.document_count, '', 5000);
                    this.updateMetric('cpuUsage', Math.round(metrics.cpu_usage), '%', 100);

                } catch (error) {
                    console.error('Error loading performance metrics:', error);
                }
            }

            async loadAlerts() {
                const alertsList = document.getElementById('alertsList');
                
                // Simulate alerts (replace with actual API call)
                const alerts = [];
                
                // Generate random alerts for demo
                if (Math.random() > 0.7) {
                    alerts.push({
                        severity: 'warning',
                        title: 'High Response Time',
                        message: 'API response time above threshold (150ms)',
                        icon: '‚ö†Ô∏è'
                    });
                }
                
                if (Math.random() > 0.9) {
                    alerts.push({
                        severity: 'critical',
                        title: 'Memory Usage Critical',
                        message: 'System memory usage above 90%',
                        icon: 'üö®'
                    });
                }

                if (alerts.length === 0) {
                    alertsList.innerHTML = `
                        <div class="alert-item alert-info">
                            <span>‚úÖ</span>
                            <div>
                                <strong>All Systems Normal</strong>
                                <div>No active alerts</div>
                            </div>
                        </div>
                    `;
                } else {
                    alertsList.innerHTML = alerts.map(alert => `
                        <div class="alert-item alert-${alert.severity}">
                            <span>${alert.icon}</span>
                            <div>
                                <strong>${alert.title}</strong>
                                <div>${alert.message}</div>
                            </div>
                        </div>
                    `).join('');
                }
            }

            updateMetric(elementId, value, unit, maxValue = 100) {
                const element = document.getElementById(elementId);
                const progressElement = document.getElementById(elementId.replace(/[A-Z]/g, letter => `${letter.toLowerCase()}`).replace(/([a-z])([A-Z])/g, '$1$2') + 'Progress');
                const trendElement = document.getElementById(elementId + 'Trend');
                
                if (element) {
                    element.innerHTML = `${value}<span class="metric-unit">${unit}</span>`;
                    
                    // Update progress bar
                    if (progressElement) {
                        const percentage = Math.min((value / maxValue) * 100, 100);
                        progressElement.style.width = `${percentage}%`;
                    }
                    
                    // Update trend (simulate)
                    if (trendElement) {
                        const trends = ['‚ÜóÔ∏è +5.2%', '‚ÜòÔ∏è -2.1%', '‚Üí Stable'];
                        const trendClasses = ['trend-up', 'trend-down', 'trend-stable'];
                        const randomTrend = Math.floor(Math.random() * 3);
                        trendElement.textContent = trends[randomTrend];
                        trendElement.className = `metric-trend ${trendClasses[randomTrend]}`;
                    }
                }
            }

            startAutoRefresh() {
                let countdown = this.refreshInterval / 1000;
                
                const updateCountdown = () => {
                    document.getElementById('refreshCountdown').textContent = 
                        `Refreshing in ${countdown}s`;
                    countdown--;
                    
                    if (countdown < 0) {
                        this.loadMetrics();
                        countdown = this.refreshInterval / 1000;
                    }
                };

                setInterval(updateCountdown, 1000);
                setInterval(() => this.loadMetrics(), this.refreshInterval);
            }

            setupEventListeners() {
                // Add keyboard shortcuts
                document.addEventListener('keydown', (event) => {
                    if (event.key === 'r' && (event.ctrlKey || event.metaKey)) {
                        event.preventDefault();
                        this.loadMetrics();
                    }
                });
            }

            showError(message) {
                const alertsList = document.getElementById('alertsList');
                const errorAlert = `
                    <div class="alert-item alert-critical">
                        <span>‚ùå</span>
                        <div>
                            <strong>Dashboard Error</strong>
                            <div>${message}</div>
                        </div>
                    </div>
                `;
                alertsList.innerHTML = errorAlert + alertsList.innerHTML;
            }
        }

        // Initialize dashboard when page loads
        document.addEventListener('DOMContentLoaded', () => {
            new RealTimeDashboard();
        });
    </script>
</body>
</html>